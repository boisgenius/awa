# 开发路线图

## 概述

本文档定义了 Claw Academy 项目的开发计划，严格遵循测试驱动开发 (TDD) 模式。

**TDD 原则**:
1. **Red**: 先编写失败的测试
2. **Green**: 编写最小代码使测试通过
3. **Refactor**: 重构代码，保持测试通过

---

## Phase 0: 项目初始化

### 0.1 环境搭建
**预计时间**: 1 天

- [ ] 初始化 Next.js 14 项目 (App Router)
- [ ] 配置 TypeScript
- [ ] 配置 Tailwind CSS
- [ ] 配置 ESLint + Prettier
- [ ] 配置 Vitest 测试框架
- [ ] 配置 Playwright E2E 测试
- [ ] 配置 Husky + lint-staged
- [ ] 创建目录结构

**验收标准**:
```bash
pnpm test        # 测试框架运行正常
pnpm test:e2e    # E2E 测试框架运行正常
pnpm lint        # 代码检查通过
pnpm build       # 构建成功
```

### 0.2 设计系统基础
**预计时间**: 1 天

- [ ] 配置 CSS 变量 (design-tokens.css)
- [ ] 配置 Tailwind 自定义主题
- [ ] 添加 Google Fonts (Inter, JetBrains Mono)
- [ ] 创建 cn() 工具函数

**测试清单**:
- [ ] `cn.test.ts` - className 合并函数测试

---

## Phase 1: 基础 UI 组件

### 1.1 Button 组件
**预计时间**: 0.5 天

**TDD 步骤**:
1. 编写测试 `button.test.tsx`
2. 实现组件 `button.tsx`
3. 重构和完善

**测试用例**:
```typescript
describe('Button', () => {
  it('renders children correctly');
  it('applies variant styles (primary, secondary, ghost)');
  it('applies size styles (sm, md, lg)');
  it('handles disabled state');
  it('handles loading state');
  it('calls onClick handler');
});
```

**变体**:
- Primary (红色背景)
- Secondary (透明 + 边框)
- Ghost (无边框)

### 1.2 Badge 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Badge', () => {
  it('renders text correctly');
  it('applies variant styles (live, dev, high, medium, emerging)');
});
```

**变体**:
- live (绿色)
- dev (黄色)
- high (红色边框)
- medium (黄色边框)
- emerging (紫色边框)

### 1.3 Card 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Card', () => {
  it('renders children correctly');
  it('applies hover effect styles');
  it('handles click event');
});
```

### 1.4 Input 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Input', () => {
  it('renders with placeholder');
  it('handles value changes');
  it('displays keyboard shortcut hint');
  it('applies focus styles');
});
```

### 1.5 Pill (Filter) 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Pill', () => {
  it('renders label and count');
  it('applies active state');
  it('handles click event');
});
```

### 1.6 IconButton 组件
**预计时间**: 0.25 天

**测试用例**:
```typescript
describe('IconButton', () => {
  it('renders icon');
  it('applies starred state');
  it('handles click event');
});
```

### 1.7 Select 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Select', () => {
  it('renders options');
  it('displays selected value');
  it('handles selection change');
});
```

---

## Phase 2: 布局组件

### 2.1 Sidebar 组件
**预计时间**: 1 天

**测试用例**:
```typescript
describe('Sidebar', () => {
  it('renders navigation sections');
  it('highlights active item');
  it('handles collapse/expand on mobile');
  it('renders token widget');
});
```

**子组件**:
- NavSection
- NavItem
- TokenWidget

### 2.2 Header 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('Header', () => {
  it('renders navigation tabs');
  it('highlights active tab');
  it('renders search box');
  it('renders connect button');
});
```

### 2.3 Footer 组件
**预计时间**: 0.25 天

**测试用例**:
```typescript
describe('Footer', () => {
  it('renders links');
  it('renders copyright text');
});
```

### 2.4 AnnouncementBar 组件
**预计时间**: 0.25 天

**测试用例**:
```typescript
describe('AnnouncementBar', () => {
  it('renders announcement message');
  it('renders link');
});
```

---

## Phase 3: 功能组件

### 3.1 SkillCard 组件
**预计时间**: 1 天

**测试用例**:
```typescript
describe('SkillCard', () => {
  it('renders skill information');
  it('displays verified badge when verified');
  it('renders status and priority badges');
  it('renders feature tags');
  it('displays rating and downloads');
  it('displays price');
  it('handles star button click');
  it('applies hover effect');
});
```

### 3.2 SkillGrid 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('SkillGrid', () => {
  it('renders list of skill cards');
  it('displays empty state when no skills');
  it('displays loading skeleton');
});
```

### 3.3 StatsBar 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('StatsBar', () => {
  it('renders stat items');
  it('displays positive change in green');
  it('displays negative change in red');
});
```

### 3.4 FilterBar 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('FilterBar', () => {
  it('renders category pills');
  it('handles category selection');
  it('renders sort select');
  it('handles sort change');
});
```

### 3.5 LeaderboardTable 组件
**预计时间**: 1 天

**测试用例**:
```typescript
describe('LeaderboardTable', () => {
  it('renders table headers');
  it('renders skill rows');
  it('displays positive change in green');
  it('displays negative change in red');
  it('handles column sorting');
  it('handles time range change');
});
```

### 3.6 SearchBox 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('SearchBox', () => {
  it('renders input with placeholder');
  it('handles input change');
  it('focuses on keyboard shortcut (Cmd+K)');
  it('debounces input');
});
```

### 3.7 WalletConnect 组件
**预计时间**: 1 天

**测试用例**:
```typescript
describe('WalletConnect', () => {
  it('displays "Connect" when not connected');
  it('opens wallet selector on click');
  it('displays address when connected');
  it('handles disconnect');
});
```

### 3.8 HeroSection 组件
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('HeroSection', () => {
  it('renders title and description');
  it('renders CTA buttons');
  it('renders onboard card');
  it('handles tab switching in onboard card');
});
```

---

## Phase 4: 状态管理和 Hooks

### 4.1 Filter Store
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('useFilterStore', () => {
  it('initializes with default values');
  it('updates category');
  it('updates sort option');
  it('updates search query');
  it('toggles verified only');
  it('resets to defaults');
});
```

### 4.2 UI Store
**预计时间**: 0.25 天

**测试用例**:
```typescript
describe('useUIStore', () => {
  it('manages sidebar visibility');
  it('manages search focus');
});
```

### 4.3 useSkills Hook
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('useSkills', () => {
  it('fetches skills with filters');
  it('returns loading state');
  it('returns error state');
  it('caches results');
});
```

### 4.4 useSearch Hook
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('useSearch', () => {
  it('filters skills by query');
  it('debounces search input');
  it('clears search');
});
```

---

## Phase 5: 页面组装

### 5.1 首页 (/)
**预计时间**: 1 天

**E2E 测试**:
```typescript
test('home page', async ({ page }) => {
  await page.goto('/');
  await expect(page.getByText('A Learning Academy for AI Agents')).toBeVisible();
  await expect(page.getByRole('button', { name: "I'm a Human" })).toBeVisible();
  await expect(page.getByRole('button', { name: "I'm an Agent" })).toBeVisible();
});

test('navigation to marketplace', async ({ page }) => {
  await page.goto('/');
  await page.click("text=I'm a Human");
  await expect(page).toHaveURL('/#marketplace');
});
```

### 5.2 市场页面集成
**预计时间**: 1 天

**E2E 测试**:
```typescript
test('marketplace', async ({ page }) => {
  await page.goto('/#marketplace');
  await expect(page.getByText('Total Skills')).toBeVisible();
  await expect(page.locator('.skill-card')).toHaveCount.greaterThan(0);
});

test('filter by category', async ({ page }) => {
  await page.goto('/#marketplace');
  await page.click('text=Coding');
  // Verify filtered results
});

test('search skills', async ({ page }) => {
  await page.goto('/#marketplace');
  await page.fill('[placeholder="Search skills..."]', 'trading');
  // Verify search results
});
```

### 5.3 排行榜集成
**预计时间**: 0.5 天

**E2E 测试**:
```typescript
test('leaderboard', async ({ page }) => {
  await page.goto('/#leaderboard');
  await expect(page.getByText('Top Performers')).toBeVisible();
  await expect(page.locator('table tbody tr')).toHaveCount.greaterThan(0);
});

test('change time range', async ({ page }) => {
  await page.goto('/#leaderboard');
  await page.click('text=7D');
  // Verify data updated
});
```

---

## Phase 6: API 集成

### 6.1 Skills API
**预计时间**: 1 天

**测试用例**:
```typescript
describe('GET /api/skills', () => {
  it('returns paginated skills');
  it('filters by category');
  it('sorts by specified field');
  it('searches by query');
});

describe('GET /api/skills/:id', () => {
  it('returns skill details');
  it('returns 404 for non-existent skill');
});
```

### 6.2 Leaderboard API
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('GET /api/leaderboard', () => {
  it('returns ranked skills');
  it('filters by time range');
});
```

### 6.3 Users API
**预计时间**: 0.5 天

**测试用例**:
```typescript
describe('GET /api/users/:address', () => {
  it('returns user profile');
  it('creates user if not exists');
});

describe('POST /api/users/:address/save', () => {
  it('adds skill to saved list');
  it('removes skill from saved list');
});
```

---

## Phase 7: 钱包集成

### 7.1 Solana 钱包适配
**预计时间**: 1 天

- [ ] 配置 @solana/wallet-adapter
- [ ] 支持 Phantom, Solflare
- [ ] 实现连接/断开逻辑
- [ ] 实现交易签名

**测试用例**:
```typescript
describe('Wallet Integration', () => {
  it('connects to Phantom');
  it('displays connected address');
  it('disconnects wallet');
  it('signs transaction');
});
```

---

## Phase 8: 优化和部署

### 8.1 性能优化
**预计时间**: 1 天

- [ ] 图片优化 (next/image)
- [ ] 代码分割
- [ ] 骨架屏加载
- [ ] 缓存策略

### 8.2 SEO 优化
**预计时间**: 0.5 天

- [ ] 元数据配置
- [ ] Open Graph 标签
- [ ] Sitemap 生成

### 8.3 部署配置
**预计时间**: 0.5 天

- [ ] Vercel 部署配置
- [ ] 环境变量配置
- [ ] CI/CD 流水线

---

## 时间线总览

| Phase | 内容 | 预计时间 |
|-------|------|----------|
| Phase 0 | 项目初始化 | 2 天 |
| Phase 1 | 基础 UI 组件 | 3 天 |
| Phase 2 | 布局组件 | 2 天 |
| Phase 3 | 功能组件 | 5.5 天 |
| Phase 4 | 状态管理和 Hooks | 1.75 天 |
| Phase 5 | 页面组装 | 2.5 天 |
| Phase 6 | API 集成 | 2 天 |
| Phase 7 | 钱包集成 | 1 天 |
| Phase 8 | 优化和部署 | 2 天 |
| **总计** | | **~22 天** |

---

## 里程碑

### M1: 静态原型 (Phase 0-3)
- 完成所有 UI 组件
- 使用 mock 数据展示页面
- 可演示完整 UI

### M2: 功能完整 (Phase 4-6)
- 完成状态管理
- API 集成
- 搜索、筛选、排序功能

### M3: 钱包集成 (Phase 7)
- 钱包连接
- 交易签名
- 用户状态持久化

### M4: 生产就绪 (Phase 8)
- 性能优化
- 部署上线
- 监控配置

---

## 风险和缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Solana 钱包兼容性问题 | 高 | 提前测试主流钱包 |
| API 性能问题 | 中 | 实施缓存策略 |
| 移动端适配 | 中 | 优先开发响应式布局 |
| 测试覆盖不足 | 高 | 严格遵循 TDD 流程 |

---

## 测试覆盖率目标

| 阶段 | 单元测试 | 集成测试 | E2E 测试 |
|------|----------|----------|----------|
| M1 | 80% | - | - |
| M2 | 80% | 70% | 50% |
| M3 | 80% | 75% | 70% |
| M4 | 85% | 80% | 80% |
